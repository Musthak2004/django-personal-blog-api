{% extends "base.html" %}
<!--                  -->

{% block title %}{{ post.title }}{% endblock title %}
<!---                 -->

{% block content %}
<div class="max-w-4xl mx-auto py-10 px-4 space-y-6">
  <h1 class="text-3xl font-playfair font-bold text-gray-800 text-center">
    {{ post.title }}
  </h1>

  {% if post.cover_image %}
  <div class="flex justify-center my-4">
    <img
      src="{{ post.cover_image.url }}"
      alt="{{ post.title }}"
      class="max-w-xs rounded shadow-md"
    />
  </div>
  {% endif %}

  <div class="prose max-w-full mx-auto">{{ post.content|linebreaks }}</div>

  <div class="flex justify-between items-center mt-6 text-gray-600 text-sm">
    <span>by {{ post.author }}</span>
    <span>ğŸ•’ Created: {{ post.created_at|date:"d M Y, h:i A" }}</span>
  </div>

  {% if post.updated_at and post.updated_at != post.created_at %}
  <div class="text-gray-500 text-sm mt-1">
    âœï¸ Updated: {{ post.updated_at|date:"d M Y, h:i A" }}
  </div>
  {% endif %}

  <div class="mt-6">
    <a href="{% url 'post_list' %}" class="text-blue-600 hover:underline">
      â† Back to posts
    </a>
  </div>
</div>

<hr class="my-10" />

<div class="max-w-3xl mx-auto space-y-6">
  <h2 class="text-xl font-semibold text-gray-800">
    ğŸ’¬ Comments ({{ post.comments.count }})
  </h2>

  {% if user.is_authenticated %}
  <form method="post" class="space-y-4 bg-white p-4 rounded shadow">
    {% csrf_token %} {{ form.as_p }}
    <button
      type="submit"
      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
    >
      Add Comment
    </button>
  </form>
  {% else %}
  <p class="text-sm text-gray-600">
    <a href="{% url 'login' %}" class="text-blue-600 hover:underline">
      Log in
    </a>
    to write a comment.
  </p>
  {% endif %}

  <!-- Comment list -->
  <div class="space-y-4">
    {% for comment in post.comments.all %}
    <div class="bg-gray-100 p-4 rounded">
      <p class="text-sm text-gray-600">
        <strong>{{ comment.author }}</strong>
        Â· {{ comment.created_at|date:"d M Y, h:i A" }}
      </p>
      <p class="mt-1 text-gray-800">{{ comment.content }}</p>

      <!-- Replies -->
      {% for reply in comment.replies.all %}
      <div class="ml-6 mt-3 bg-white p-3 rounded border">
        <p class="text-sm text-gray-600">
          <strong>{{ reply.author }}</strong>
        </p>
        <p>{{ reply.content }}</p>
      </div>
      {% endfor %}
    </div>
    {% empty %}
    <p class="text-gray-600">No comments yet. Be the first!</p>
    {% endfor %}
  </div>
</div>
{% endblock content %}
