{% extends "base.html" %}
<!--                      -->

{% block title %}{{ post.title }} - Philosophy.{% endblock %}
<!--                      -->

{% block content %}

<div class="max-w-4xl mx-auto px-6 py-20">
  <article class="prose prose-invert max-w-none">
    <h1
      class="text-5xl md:text-7xl font-serif font-black text-white mb-8 leading-tight"
    >
      {{ post.title }}
    </h1>

    {% if post.cover_image %}
    <img
      src="{{ post.cover_image.url }}"
      alt="{{ post.title }}"
      class="w-full rounded-xl mb-12 shadow-2xl"
    />
    {% endif %}

    <div class="text-gray-300 text-lg leading-relaxed mb-12">
      {{ post.content|linebreaks }}
    </div>

    <div
      class="flex flex-wrap items-center justify-between text-gray-500 text-sm border-t border-gray-800 pt-8 mt-12"
    >
      <div>
        by <span class="text-white">{{ post.author }}</span> ¬∑ {{
        post.created_at|date:"d M Y" }}
      </div>
      {% if post.updated_at and post.updated_at != post.created_at %}
      <div>Updated {{ post.updated_at|date:"d M Y" }}</div>
      {% endif %}
    </div>

    {% if post.tags.all %}
    <div class="mt-8 flex flex-wrap gap-3">
      {% for tag in post.tags.all %}
      <a
        href="{% url 'post_list' %}?tag={{ tag.slug }}"
        class="px-4 py-2 bg-gray-800 rounded-full text-sm hover:bg-gray-700 transition"
      >
        #{{ tag.name }}
      </a>
      {% endfor %}
    </div>
    {% endif %}
  </article>

  <!-- Likes -->
  <div class="mt-16 flex items-center space-x-6">
    <form method="post" class="inline">
      {% csrf_token %}
      <button
        type="submit"
        name="like_submit"
        class="flex items-center space-x-3 px-6 py-3 rounded-full {% if user_liked %}bg-red-600 hover:bg-red-700{% else %}bg-gray-800 hover:bg-gray-700{% endif %} transition font-medium"
      >
        {% if user_liked %}
        <span class="text-2xl">‚ù§Ô∏è</span>
        <span>Liked</span>
        {% else %}
        <span class="text-2xl">ü§ç</span>
        <span>Like</span>
        {% endif %}
      </button>
    </form>
    <span class="text-xl font-medium"
      >{{ likes_count }} like{{ likes_count|pluralize }}</span
    >
  </div>

  <!-- Comments -->
  <div class="mt-20">
    <h2 class="text-3xl font-serif font-bold text-white mb-8">
      Thoughts ({{ post.comments.count }})
    </h2>

    {% if user.is_authenticated %}
    <form
      method="post"
      class="bg-gray-900 p-8 rounded-xl border border-gray-800 mb-12"
    >
      {% csrf_token %} {{ form.as_p }}
      <button
        type="submit"
        name="comment_submit"
        class="mt-4 bg-accent text-black font-bold px-8 py-4 rounded-full hover:bg-accent/90 transition uppercase tracking-wider"
      >
        Share Thought
      </button>
    </form>
    {% else %}
    <p class="text-gray-400">
      <a href="{% url 'login' %}" class="text-accent hover:underline">Login</a>
      to share your thoughts.
    </p>
    {% endif %}

    <div class="space-y-10">
      {% for comment in post.comments.all %}
      <div class="bg-gray-900 p-8 rounded-xl border border-gray-800">
        <p class="text-gray-400 text-sm mb-3">
          {{ comment.author }} ¬∑ {{ comment.created_at|date:"d M Y" }}
        </p>
        <p class="text-gray-200">{{ comment.content }}</p>
      </div>
      {% empty %}
      <p class="text-gray-500 italic">
        No thoughts yet. Start the conversation.
      </p>
      {% endfor %}
    </div>
  </div>

  <div class="mt-20 text-center">
    <a
      href="{% url 'post_list' %}"
      class="text-accent hover:text-white transition uppercase tracking-wider"
      >‚Üê Back to thoughts</a
    >
  </div>
</div>

{% endblock %}
