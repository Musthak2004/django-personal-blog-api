{% extends "base.html" %}
<!--                   -->
{% block title %}{{ post.title }}{% endblock title %}
<!--                         -->

{% block content %}
<div class="max-w-4xl mx-auto py-10 px-4 space-y-6">
  <!-- Post Title -->
  <h1 class="text-3xl font-playfair font-bold text-gray-800 text-center">
    {{ post.title }}
  </h1>

  <!-- Cover Image -->
  {% if post.cover_image %}
  <div class="flex justify-center my-4">
    <img
      src="{{ post.cover_image.url }}"
      alt="{{ post.title }}"
      class="max-w-xs rounded shadow-md"
    />
  </div>
  {% endif %}

  <!-- Post Content -->
  <div class="prose max-w-full mx-auto">{{ post.content|linebreaks }}</div>

  <!-- Post Meta -->
  <div class="flex justify-between items-center mt-6 text-gray-600 text-sm">
    <span>by {{ post.author }}</span>
    <span>ğŸ•’ Created: {{ post.created_at|date:"d M Y, h:i A" }}</span>
  </div>

  {% if post.updated_at and post.updated_at != post.created_at %}
  <div class="text-gray-500 text-sm mt-1">
    âœï¸ Updated: {{ post.updated_at|date:"d M Y, h:i A" }}
  </div>
  {% endif %}

  <!-- Tags Section -->
  {% if tags %}
  <div class="flex flex-wrap gap-2 mt-4">
    {% for tag in tags %}
    <a
      href="{% url 'post_list' %}?tag={{ tag.slug }}"
      class="px-2 py-1 bg-gray-200 text-sm rounded hover:bg-gray-300"
    >
      #{{ tag.name }}
    </a>
    {% endfor %}
  </div>
  {% endif %}

  <!-- Back Link -->
  <div class="mt-6">
    <a href="{% url 'post_list' %}" class="text-blue-600 hover:underline">
      â† Back to posts
    </a>
  </div>
</div>

<hr class="my-10" />

<div class="max-w-3xl mx-auto space-y-6">
  <!-- Likes Section -->
  <div class="flex items-center space-x-4">
    <form method="post" class="inline">
      {% csrf_token %}
      <button
        type="submit"
        name="like_submit"
        class="flex items-center space-x-2 px-5 py-2 rounded-full font-medium transition duration-200 {% if user_liked %} bg-red-500 text-white hover:bg-red-600 {% else %} bg-gray-200 text-gray-700 hover:bg-gray-300 {% endif %}"
      >
        {% if user_liked %}
        <span>â¤ï¸</span>
        <span>Liked</span>
        {% else %}
        <span>ğŸ¤</span>
        <span>Like</span>
        {% endif %}
      </button>
    </form>

    <span class="text-gray-600 font-medium">
      {{ likes_count }} like{{ likes_count|pluralize }}
    </span>
  </div>

  <!-- Comments Section -->
  <h2 class="text-xl font-semibold text-gray-800 mt-6">
    ğŸ’¬ Comments ({{ post.comments.count }})
  </h2>

  {% if user.is_authenticated %}
  <form method="post" class="space-y-4 bg-white p-4 rounded shadow">
    {% csrf_token %} {{ form.as_p }}
    <button
      type="submit"
      name="comment_submit"
      class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 transition"
    >
      Add Comment
    </button>
  </form>
  {% else %}
  <p class="text-sm text-gray-600">
    <a href="{% url 'login' %}" class="text-blue-600 hover:underline">
      Log in
    </a>
    to write a comment.
  </p>
  {% endif %}

  <!-- Comment List -->
  <div class="space-y-4">
    {% for comment in post.comments.all %}
    <div class="bg-gray-100 p-4 rounded">
      <p class="text-sm text-gray-600">
        <strong>{{ comment.author }}</strong> Â· {{ comment.created_at }}
      </p>
      <p class="mt-1 text-gray-800">{{ comment.content }}</p>

      <!-- Replies -->
      {% for reply in comment.replies.all %}
      <div class="ml-6 mt-3 bg-white p-3 rounded border">
        <p class="text-sm text-gray-600"><strong>{{ reply.author }}</strong></p>
        <p>{{ reply.content }}</p>
      </div>
      {% endfor %}
    </div>
    {% empty %}
    <p class="text-gray-600">No comments yet. Be the first!</p>
    {% endfor %}
  </div>
</div>
{% endblock content %}
